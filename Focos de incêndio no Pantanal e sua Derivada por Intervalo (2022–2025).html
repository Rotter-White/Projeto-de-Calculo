<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√°lculo de Derivadas: Queimadas no Pantanal</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #4b5563;
            --accent-red: #ef4444;
            --accent-blue: #3b82f6;
            --grid-line: #e5e7eb;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            max-width: 1000px;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            color: #111827;
        }

        .header p {
            color: var(--text-secondary);
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* Canvas Container */
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
            overflow: hidden;
        }

        canvas {
            width: 100%;
            height: 100%;
        }

        /* Math Section Styles */
        .math-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .math-section {
                grid-template-columns: 1fr;
            }
        }

        .formula-box {
            background: #f8fafc;
            border-left: 4px solid var(--accent-blue);
            padding: 15px;
            font-family: 'Courier New', Courier, monospace;
            margin-bottom: 15px;
            overflow-x: auto;
        }

        .calculation-step {
            margin-bottom: 10px;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .highlight {
            font-weight: bold;
        }

        .btn-group {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            background-color: #e5e7eb;
            color: #374151;
        }

        button.active {
            background-color: var(--accent-blue);
            color: white;
        }

        button:hover:not(.active) {
            background-color: #d1d5db;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            font-size: 0.9rem;
            flex-wrap: wrap;
        }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .dot { width: 12px; height: 12px; border-radius: 50%; }
        .line-sample { width: 20px; height: 3px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Focos de inc√™ndio no Pantanal e sua Derivada por Intervalo (2022‚Äì2025)</h1>
        <p>An√°lise de Taxa de Varia√ß√£o (Acelera√ß√£o e Desacelera√ß√£o)</p>
    </div>

    <!-- Controles -->
    <div class="btn-group">
        <button onclick="setYear(2023)" id="btn-2023" class="active">Intervalo 2022 ‚Üí 2023</button>
        <button onclick="setYear(2024)" id="btn-2024">Intervalo 2023 ‚Üí 2024</button>
        <button onclick="setYear(2025)" id="btn-2025">Intervalo 2024 ‚Üí 2025</button>
    </div>

    <!-- Gr√°fico -->
    <div class="card">
        <div class="chart-container">
            <canvas id="fireChart"></canvas>
        </div>
        <div class="legend">
            <div class="legend-item">
                <div class="dot" style="background: #ef4444;"></div> 
                <span style="color: #ef4444; font-weight: bold;">Curva 1: Focos Brutos</span>
            </div>
            <div class="legend-item">
                <div class="dot" style="background: #3b82f6;"></div> 
                <span style="color: #3b82f6; font-weight: bold;">Curva 2: Derivada (Varia√ß√£o)</span>
            </div>
            <div class="legend-item">
                <span style="color: #9ca3af; font-size: 0.8em;">(Eixo Y compartilhado para compara√ß√£o de magnitude)</span>
            </div>
        </div>
    </div>

    <!-- Se√ß√£o Matem√°tica -->
    <div class="math-section">
        <!-- Coluna Esquerda: Defini√ß√£o -->
        <div class="card">
            <h3>üìâ Defini√ß√£o da Derivada Discreta</h3>
            <p>Para dados anuais, a derivada representa a varia√ß√£o absoluta de focos de um ano para o outro.</p>
            
            <div class="formula-box">
                f'(t) ‚âà Œîf / Œît = f(t) - f(t-1)
            </div>
            <p>Onde <strong>Œît = 1 ano</strong>.</p>
            <p>Se a derivada √© <strong>positiva</strong>, os focos aumentaram (Acelera√ß√£o).<br>
               Se a derivada √© <strong>negativa</strong>, os focos diminu√≠ram (Desacelera√ß√£o).</p>
        </div>

        <!-- Coluna Direita: Aplica√ß√£o -->
        <div class="card">
            <h3>üßÆ C√°lculo para o Ano Final: <span id="year-label">2023</span></h3>
            <div id="calc-content">
                <!-- Conte√∫do injetado via JS -->
            </div>
        </div>
    </div>
</div>

<script>
    // --- 1. Dados Reais (Pantanal 2022-2025) ---
    const rawData = [
        { year: 2022, value: 1175 },
        { year: 2023, value: 2627 },
        { year: 2024, value: 14483 },
        { year: 2025, value: 173 }
    ];

    // --- 2. C√°lculo da Derivada (Pr√©-processamento) ---
    // Derivada alinhada com o ano final do intervalo
    const derivativeData = [];
    for (let i = 1; i < rawData.length; i++) {
        const current = rawData[i];
        const previous = rawData[i-1];
        const change = current.value - previous.value;
        derivativeData.push({
            year: current.year,
            value: change,
            prevYear: previous.year,
            prevValue: previous.value,
            currValue: current.value
        });
    }

    // --- 3. Configura√ß√£o do Canvas ---
    const canvas = document.getElementById('fireChart');
    const ctx = canvas.getContext('2d');
    let currentSelectedYear = 2023; // Padr√£o inicial

    function resizeCanvas() {
        const container = canvas.parentElement;
        canvas.width = container.clientWidth * window.devicePixelRatio;
        canvas.height = container.clientHeight * window.devicePixelRatio;
        ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
        drawChart();
    }

    window.addEventListener('resize', resizeCanvas);

    // --- 4. Fun√ß√£o de Desenho Principal ---
    function drawChart() {
        const width = canvas.width / window.devicePixelRatio;
        const height = canvas.height / window.devicePixelRatio;
        const padding = { top: 40, right: 60, bottom: 60, left: 80 };

        // Limpar
        ctx.clearRect(0, 0, width, height);

        // Definir Escalas (Y Min e Max din√¢micos para acomodar negativos)
        // Max value entre focos e derivadas para definir o teto e ch√£o do gr√°fico
        const allValues = [...rawData.map(d => d.value), ...derivativeData.map(d => d.value)];
        let maxVal = Math.max(...allValues);
        let minVal = Math.min(...allValues);
        
        // Adicionar margem de respiro
        maxVal = Math.ceil(maxVal / 1000) * 1000 + 2000;
        minVal = Math.floor(minVal / 1000) * 1000 - 2000;

        const xStep = (width - padding.left - padding.right) / (rawData.length - 1);
        
        // Fun√ß√£o para mapear Valor -> Pixel Y
        const getY = (val) => {
            const range = maxVal - minVal;
            const ratio = (val - minVal) / range;
            return height - padding.bottom - (ratio * (height - padding.top - padding.bottom));
        };
        
        // Fun√ß√£o para mapear Ano -> Pixel X
        // Precisamos mapear o √≠ndice baseado no array completo de anos (rawData)
        const getX = (year) => {
            const index = rawData.findIndex(d => d.year === year);
            return padding.left + index * xStep;
        };

        // --- Grade e Eixos ---
        ctx.strokeStyle = '#e5e7eb';
        ctx.lineWidth = 1;
        ctx.font = '12px Arial';
        ctx.textAlign = 'right';
        ctx.textBaseline = 'middle';

        // Linhas horizontais (Grade Y)
        const stepY = 5000; // Passo da grade
        // Arredondar minVal para o m√∫ltiplo de stepY mais pr√≥ximo
        const startY = Math.floor(minVal / stepY) * stepY;
        
        for (let v = startY; v <= maxVal; v += stepY) {
            let y = getY(v);
            
            // Desenhar linha zero mais forte
            if (v === 0) {
                ctx.strokeStyle = '#9ca3af';
                ctx.lineWidth = 2;
            } else {
                ctx.strokeStyle = '#e5e7eb';
                ctx.lineWidth = 1;
            }

            ctx.beginPath();
            ctx.moveTo(padding.left, y);
            ctx.lineTo(width - padding.right, y);
            ctx.stroke();

            // Texto do eixo Y
            ctx.fillStyle = '#6b7280';
            ctx.fillText(v.toLocaleString(), padding.left - 10, y);
        }

        // --- 1. Desenhar Curva de Focos (Bruta) ---
        ctx.beginPath();
        ctx.strokeStyle = '#ef4444'; // Vermelho
        ctx.lineWidth = 3;
        ctx.lineJoin = 'round';
        rawData.forEach((d, i) => {
            let x = getX(d.year);
            let y = getY(d.value);
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        });
        ctx.stroke();

        // Pontos Focos
        rawData.forEach((d) => {
            let x = getX(d.year);
            let y = getY(d.value);
            ctx.beginPath();
            ctx.fillStyle = '#ffffff';
            ctx.strokeStyle = '#ef4444';
            ctx.lineWidth = 2;
            ctx.arc(x, y, 5, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();
            
            // Label valor
            ctx.fillStyle = '#ef4444';
            ctx.textAlign = 'center';
            ctx.fillText(d.value.toLocaleString(), x, y - 15);
        });

        // --- 2. Desenhar Curva Derivada (Taxa) ---
        // A derivada s√≥ existe a partir de 2023
        ctx.beginPath();
        ctx.strokeStyle = '#3b82f6'; // Azul
        ctx.lineWidth = 3;
        ctx.setLineDash([5, 5]); // Tracejado para diferenciar
        derivativeData.forEach((d, i) => {
            let x = getX(d.year);
            let y = getY(d.value);
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        });
        ctx.stroke();
        ctx.setLineDash([]); // Reset

        // Pontos Derivada
        derivativeData.forEach((d) => {
            let x = getX(d.year);
            let y = getY(d.value);
            
            // Destaque se for o ano selecionado
            const isSelected = d.year === currentSelectedYear;
            const radius = isSelected ? 8 : 5;

            ctx.beginPath();
            ctx.fillStyle = isSelected ? '#3b82f6' : '#ffffff';
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 2;
            ctx.arc(x, y, radius, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();

            // Label valor derivada
            ctx.fillStyle = '#3b82f6';
            ctx.textAlign = 'center';
            ctx.fillText((d.value > 0 ? '+' : '') + d.value.toLocaleString(), x, y - (d.value < 0 ? -25 : 15));
        });

        // Eixo X (Anos)
        ctx.textAlign = 'center';
        ctx.fillStyle = '#374151';
        rawData.forEach((d) => {
            let x = getX(d.year);
            ctx.fillText(d.year, x, height - 20);
        });

        // Indicador Visual do Intervalo Selecionado
        const selectedData = derivativeData.find(d => d.year === currentSelectedYear);
        if (selectedData) {
            const xPrev = getX(selectedData.prevYear);
            const xCurr = getX(selectedData.year);
            const yRawPrev = getY(selectedData.prevValue);
            const yRawCurr = getY(selectedData.currValue);

            // Desenhar linha conectando os pontos brutos (Secante visual)
            ctx.beginPath();
            ctx.strokeStyle = 'rgba(59, 130, 246, 0.4)';
            ctx.lineWidth = 10;
            ctx.moveTo(xPrev, yRawPrev);
            ctx.lineTo(xCurr, yRawCurr);
            ctx.stroke();
        }
    }

    // --- 5. L√≥gica de Interface ---
    function setYear(year) {
        currentSelectedYear = year;
        
        // Atualizar bot√µes
        document.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
        const btn = document.getElementById(`btn-${year}`);
        if(btn) btn.classList.add('active');
        
        document.getElementById('year-label').innerText = year;

        // Redesenhar Canvas
        drawChart();

        // Atualizar Texto Matem√°tico
        updateMathText(year);
    }

    function updateMathText(year) {
        const data = derivativeData.find(d => d.year === year);
        
        if (!data) return;

        const isPositive = data.value > 0;
        const color = isPositive ? '#ef4444' : '#10b981'; // Vermelho para aumento, Verde para queda
        const trendText = isPositive ? "ACELERA√á√ÉO (Aumento de Focos)" : "DESACELERA√á√ÉO (Queda de Focos)";

        const html = `
            <div class="calculation-step">
                <strong>1. Dados do Intervalo:</strong><br>
                Ano Inicial (${data.prevYear}): ${data.prevValue.toLocaleString()} focos<br>
                Ano Final (${data.year}): ${data.currValue.toLocaleString()} focos
            </div>
            
            <div class="calculation-step">
                <strong>2. C√°lculo da Derivada (Varia√ß√£o):</strong><br>
                f'(${data.year}) = f(${data.year}) - f(${data.prevYear})
            </div>

            <div class="calculation-step">
                <strong>3. Resultado:</strong><br>
                = ${data.currValue.toLocaleString()} - ${data.prevValue.toLocaleString()}<br>
                = <span class="highlight" style="color: ${color}; font-size: 1.2em;">
                    ${data.value > 0 ? '+' : ''}${data.value.toLocaleString()}
                  </span> focos/ano
            </div>

            <div class="calculation-step" style="background: #eef2ff; padding: 10px; border-radius: 6px; margin-top: 10px;">
                <strong>Interpreta√ß√£o:</strong><br>
                Neste intervalo, o Pantanal apresentou uma forte <strong>${trendText}</strong>.
                ${data.value < -10000 ? '<br>Note a queda brusca (derivada altamente negativa) em rela√ß√£o ao pico anterior.' : ''}
                ${data.value > 10000 ? '<br>Note o pico explosivo (derivada altamente positiva).' : ''}
            </div>
        `;

        document.getElementById('calc-content').innerHTML = html;
    }

    // Inicializa√ß√£o
    setTimeout(resizeCanvas, 100);
    // Inicializar com o primeiro ano de derivada dispon√≠vel
    updateMathText(2023);

</script>

</body>
</html>